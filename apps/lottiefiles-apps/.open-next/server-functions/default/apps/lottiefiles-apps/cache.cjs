globalThis.disableIncrementalCache = false;globalThis.disableDynamoDBCache = false;globalThis.openNextDebug = false;globalThis.openNextVersion = "3.0.2";
var h=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var C=(t,a)=>{for(var e in a)h(t,e,{get:a[e],enumerable:!0})},v=(t,a,e,o)=>{if(a&&typeof a=="object"||typeof a=="function")for(let i of b(a))!T.call(t,i)&&i!==e&&h(t,i,{get:()=>a[i],enumerable:!(o=u(a,i))||o.enumerable});return t};var x=t=>v(h({},"__esModule",{value:!0}),t);var D={};C(D,{default:()=>p,hasCacheExtension:()=>M});module.exports=x(D);var w=new Set(["application/octet-stream","application/epub+zip","application/msword","application/pdf","application/rtf","application/vnd.amazon.ebook","application/vnd.ms-excel","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.wordprocessingml.document","font/otf","font/woff","font/woff2","image/bmp","image/gif","image/jpeg","image/png","image/tiff","image/vnd.microsoft.icon","image/webp","audio/3gpp","audio/aac","audio/basic","audio/mpeg","audio/ogg","audio/wavaudio/webm","audio/x-aiff","audio/x-midi","audio/x-wav","video/3gpp","video/mp2t","video/mpeg","video/ogg","video/quicktime","video/webm","video/x-msvideo","application/java-archive","application/vnd.apple.installer+xml","application/x-7z-compressed","application/x-apple-diskimage","application/x-bzip","application/x-bzip2","application/x-gzip","application/x-java-archive","application/x-rar-compressed","application/x-tar","application/x-zip","application/zip"]);function m(t){if(!t)return!1;let a=t?.split(";")[0]??"";return w.has(a)}function c(...t){globalThis.openNextDebug&&console.log(...t)}function g(...t){console.warn(...t)}var y=[{clientName:"S3Client",commandName:"GetObjectCommand",errorName:"NoSuchKey"}],E=t=>y.some(a=>a.clientName===t?.clientName&&a.commandName===t?.commandName&&(a.errorName===t?.error?.name||a.errorName===t?.error?.Code));function f(...t){if(t.some(a=>E(a))){g(...t);return}console.error(...t)}var N=/\.(cache|fetch)$/;function M(t){return N.test(t)}var p=class{constructor(a){}async get(a,e){return globalThis.disableIncrementalCache?null:(typeof e=="object"?e.kindHint?e.kindHint==="fetch":e.fetchCache:e)?this.getFetchCache(a):this.getIncrementalCache(a)}async getFetchCache(a){c("get fetch cache",{key:a});try{let{value:e,lastModified:o}=await globalThis.incrementalCache.get(a,!0),i=await globalThis.tagCache.getLastModified(a,o);return i===-1||e===void 0?null:{lastModified:i,value:e}}catch(e){return f("Failed to get fetch cache",e),null}}async getIncrementalCache(a){try{let{value:e,lastModified:o}=await globalThis.incrementalCache.get(a,!1),i=e?.meta,s=await globalThis.tagCache.getLastModified(a,o);if(s===-1)return null;let r=globalThis.__als.getStore()??"";return globalThis.lastModified[r]=s,e?.type==="route"?{lastModified:s,value:{kind:"ROUTE",body:Buffer.from(e.body??Buffer.alloc(0),m(String(i?.headers?.["content-type"]))?"base64":"utf8"),status:i?.status,headers:i?.headers}}:e?.type==="page"||e?.type==="app"?{lastModified:s,value:{kind:"PAGE",html:e.html,pageData:e.type==="page"?e.json:e.rsc,status:i?.status,headers:i?.headers}}:e?.type==="redirect"?{lastModified:s,value:{kind:"REDIRECT",props:e.props}}:(g("Unknown cache type",e),null)}catch(e){return f("Failed to get body cache",e),null}}async set(a,e,o){if(globalThis.disableIncrementalCache)return;if(e?.kind==="ROUTE"){let{body:n,status:l,headers:d}=e;await globalThis.incrementalCache.set(a,{type:"route",body:n.toString(m(String(d["content-type"]))?"base64":"utf8"),meta:{status:l,headers:d}},!1)}else if(e?.kind==="PAGE"){let{html:n,pageData:l}=e;typeof l=="string"?globalThis.incrementalCache.set(a,{type:"app",html:n,rsc:l},!1):globalThis.incrementalCache.set(a,{type:"page",html:n,json:l},!1)}else e?.kind==="FETCH"?await globalThis.incrementalCache.set(a,e,!0):e?.kind==="REDIRECT"?await globalThis.incrementalCache.set(a,{type:"redirect",props:e.props},!1):e==null&&await globalThis.incrementalCache.delete(a);let i=e?.kind==="FETCH"?o?.tags??e?.data?.tags??[]:e?.kind==="PAGE"?e.headers?.["x-next-cache-tags"]?.split(",")??[]:[];c("derivedTags",i);let s=await globalThis.tagCache.getByPath(a),r=i.filter(n=>!s.includes(n));r.length>0&&await globalThis.tagCache.writeTags(r.map(n=>({path:a,tag:n})))}async revalidateTag(a){if(globalThis.disableDynamoDBCache||globalThis.disableIncrementalCache)return;c("revalidateTag",a);let e=await globalThis.tagCache.getByTag(a);c("Items",e),await globalThis.tagCache.writeTags(e?.map(o=>({path:o,tag:a}))??[])}};0&&(module.exports={hasCacheExtension});
